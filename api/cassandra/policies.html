
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="refresh" content="0; URL=https://docs.datastax.com/en/developer/python-driver/latest/api/cassandra/policies/">
    <link rel="canonical" href="https://docs.datastax.com/en/developer/python-driver/latest/api/cassandra/policies/">
    <title>cassandra.policies - Load balancing and Failure Handling Policies &#8212; Cassandra Driver 3.13.0 documentation</title>
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.13.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="cassandra.auth - Authentication" href="auth.html" />
    <link rel="prev" title="cassandra.cluster - Clusters and Sessions" href="cluster.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-cassandra.policies">
<span id="cassandra-policies-load-balancing-and-failure-handling-policies"></span><h1><code class="docutils literal"><span class="pre">cassandra.policies</span></code> - Load balancing and Failure Handling Policies<a class="headerlink" href="#module-cassandra.policies" title="Permalink to this headline">¶</a></h1>
<div class="section" id="load-balancing">
<h2>Load Balancing<a class="headerlink" href="#load-balancing" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cassandra.policies.HostDistance">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">HostDistance</code><a class="reference internal" href="../../_modules/cassandra/policies.html#HostDistance"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.HostDistance" title="Permalink to this definition">¶</a></dt>
<dd><p>A measure of how “distant” a node is from the client, which
may influence how the load balancer distributes requests
and how many connections are opened to the node.</p>
<dl class="attribute">
<dt id="cassandra.policies.HostDistance.IGNORED">
<code class="descname">IGNORED</code><em class="property"> = -1</em><a class="headerlink" href="#cassandra.policies.HostDistance.IGNORED" title="Permalink to this definition">¶</a></dt>
<dd><p>A node with this distance should never be queried or have
connections opened to it.</p>
</dd></dl>

<dl class="attribute">
<dt id="cassandra.policies.HostDistance.LOCAL">
<code class="descname">LOCAL</code><em class="property"> = 0</em><a class="headerlink" href="#cassandra.policies.HostDistance.LOCAL" title="Permalink to this definition">¶</a></dt>
<dd><p>Nodes with <code class="docutils literal"><span class="pre">LOCAL</span></code> distance will be preferred for operations
under some load balancing policies (such as <a class="reference internal" href="#cassandra.policies.DCAwareRoundRobinPolicy" title="cassandra.policies.DCAwareRoundRobinPolicy"><code class="xref py py-class docutils literal"><span class="pre">DCAwareRoundRobinPolicy</span></code></a>)
and will have a greater number of connections opened against
them by default.</p>
<p>This distance is typically used for nodes within the same
datacenter as the client.</p>
</dd></dl>

<dl class="attribute">
<dt id="cassandra.policies.HostDistance.REMOTE">
<code class="descname">REMOTE</code><em class="property"> = 1</em><a class="headerlink" href="#cassandra.policies.HostDistance.REMOTE" title="Permalink to this definition">¶</a></dt>
<dd><p>Nodes with <code class="docutils literal"><span class="pre">REMOTE</span></code> distance will be treated as a last resort
by some load balancing policies (such as <a class="reference internal" href="#cassandra.policies.DCAwareRoundRobinPolicy" title="cassandra.policies.DCAwareRoundRobinPolicy"><code class="xref py py-class docutils literal"><span class="pre">DCAwareRoundRobinPolicy</span></code></a>)
and will have a smaller number of connections opened against
them by default.</p>
<p>This distance is typically used for nodes outside of the
datacenter that the client is running in.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cassandra.policies.LoadBalancingPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">LoadBalancingPolicy</code><a class="reference internal" href="../../_modules/cassandra/policies.html#LoadBalancingPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.LoadBalancingPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>Load balancing policies are used to decide how to distribute
requests among all possible coordinator nodes in the cluster.</p>
<p>In particular, they may focus on querying “near” nodes (those
in a local datacenter) or on querying nodes who happen to
be replicas for the requested data.</p>
<p>You may also use subclasses of <a class="reference internal" href="#cassandra.policies.LoadBalancingPolicy" title="cassandra.policies.LoadBalancingPolicy"><code class="xref py py-class docutils literal"><span class="pre">LoadBalancingPolicy</span></code></a> for
custom behavior.</p>
<dl class="method">
<dt id="cassandra.policies.LoadBalancingPolicy.distance">
<code class="descname">distance</code><span class="sig-paren">(</span><em>host</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#LoadBalancingPolicy.distance"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.LoadBalancingPolicy.distance" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a measure of how remote a <a class="reference internal" href="pool.html#cassandra.pool.Host" title="cassandra.pool.Host"><code class="xref py py-class docutils literal"><span class="pre">Host</span></code></a> is in
terms of the <a class="reference internal" href="#cassandra.policies.HostDistance" title="cassandra.policies.HostDistance"><code class="xref py py-class docutils literal"><span class="pre">HostDistance</span></code></a> enums.</p>
</dd></dl>

<dl class="method">
<dt id="cassandra.policies.LoadBalancingPolicy.populate">
<code class="descname">populate</code><span class="sig-paren">(</span><em>cluster</em>, <em>hosts</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#LoadBalancingPolicy.populate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.LoadBalancingPolicy.populate" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called to initialize the load balancing
policy with a set of <a class="reference internal" href="pool.html#cassandra.pool.Host" title="cassandra.pool.Host"><code class="xref py py-class docutils literal"><span class="pre">Host</span></code></a> instances before its
first use.  The <cite>cluster</cite> parameter is an instance of
<a class="reference internal" href="cluster.html#cassandra.cluster.Cluster" title="cassandra.cluster.Cluster"><code class="xref py py-class docutils literal"><span class="pre">Cluster</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="cassandra.policies.LoadBalancingPolicy.make_query_plan">
<code class="descname">make_query_plan</code><span class="sig-paren">(</span><em>working_keyspace=None</em>, <em>query=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#LoadBalancingPolicy.make_query_plan"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.LoadBalancingPolicy.make_query_plan" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a <a class="reference internal" href="query.html#cassandra.query.Statement" title="cassandra.query.Statement"><code class="xref py py-class docutils literal"><span class="pre">Statement</span></code></a> instance, return a iterable
of <a class="reference internal" href="pool.html#cassandra.pool.Host" title="cassandra.pool.Host"><code class="xref py py-class docutils literal"><span class="pre">Host</span></code></a> instances which should be queried in that
order.  A generator may work well for custom implementations
of this method.</p>
<p>Note that the <cite>query</cite> argument may be <code class="xref py py-const docutils literal"><span class="pre">None</span></code> when preparing
statements.</p>
<p><cite>working_keyspace</cite> should be the string name of the current keyspace,
as set through <a class="reference internal" href="cluster.html#cassandra.cluster.Session.set_keyspace" title="cassandra.cluster.Session.set_keyspace"><code class="xref py py-meth docutils literal"><span class="pre">Session.set_keyspace()</span></code></a> or with a <code class="docutils literal"><span class="pre">USE</span></code>
statement.</p>
</dd></dl>

<dl class="method">
<dt id="cassandra.policies.LoadBalancingPolicy.check_supported">
<code class="descname">check_supported</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#LoadBalancingPolicy.check_supported"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.LoadBalancingPolicy.check_supported" title="Permalink to this definition">¶</a></dt>
<dd><p>This will be called after the cluster Metadata has been initialized.
If the load balancing policy implementation cannot be supported for
some reason (such as a missing C extension), this is the point at
which it should raise an exception.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cassandra.policies.RoundRobinPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">RoundRobinPolicy</code><a class="reference internal" href="../../_modules/cassandra/policies.html#RoundRobinPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.RoundRobinPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>A subclass of <a class="reference internal" href="#cassandra.policies.LoadBalancingPolicy" title="cassandra.policies.LoadBalancingPolicy"><code class="xref py py-class docutils literal"><span class="pre">LoadBalancingPolicy</span></code></a> which evenly
distributes queries across all nodes in the cluster,
regardless of what datacenter the nodes may be in.</p>
<p>This load balancing policy is used by default.</p>
</dd></dl>

<dl class="class">
<dt id="cassandra.policies.DCAwareRoundRobinPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">DCAwareRoundRobinPolicy</code><span class="sig-paren">(</span><em>local_dc=''</em>, <em>used_hosts_per_remote_dc=0</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#DCAwareRoundRobinPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.DCAwareRoundRobinPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>Similar to <a class="reference internal" href="#cassandra.policies.RoundRobinPolicy" title="cassandra.policies.RoundRobinPolicy"><code class="xref py py-class docutils literal"><span class="pre">RoundRobinPolicy</span></code></a>, but prefers hosts
in the local datacenter and only uses nodes in remote
datacenters as a last resort.</p>
<p>The <cite>local_dc</cite> parameter should be the name of the datacenter
(such as is reported by <code class="docutils literal"><span class="pre">nodetool</span> <span class="pre">ring</span></code>) that should
be considered local. If not specified, the driver will choose
a local_dc based on the first host among <a class="reference internal" href="cluster.html#cassandra.cluster.Cluster.contact_points" title="cassandra.cluster.Cluster.contact_points"><code class="xref py py-attr docutils literal"><span class="pre">Cluster.contact_points</span></code></a>
having a valid DC. If relying on this mechanism, all specified
contact points should be nodes in a single, local DC.</p>
<p><cite>used_hosts_per_remote_dc</cite> controls how many nodes in
each remote datacenter will have connections opened
against them. In other words, <cite>used_hosts_per_remote_dc</cite> hosts
will be considered <a class="reference internal" href="#cassandra.policies.HostDistance.REMOTE" title="cassandra.policies.HostDistance.REMOTE"><code class="xref py py-attr docutils literal"><span class="pre">REMOTE</span></code></a> and the
rest will be considered <a class="reference internal" href="#cassandra.policies.HostDistance.IGNORED" title="cassandra.policies.HostDistance.IGNORED"><code class="xref py py-attr docutils literal"><span class="pre">IGNORED</span></code></a>.
By default, all remote hosts are ignored.</p>
</dd></dl>

<dl class="class">
<dt id="cassandra.policies.WhiteListRoundRobinPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">WhiteListRoundRobinPolicy</code><span class="sig-paren">(</span><em>hosts</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#WhiteListRoundRobinPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.WhiteListRoundRobinPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>A subclass of <a class="reference internal" href="#cassandra.policies.RoundRobinPolicy" title="cassandra.policies.RoundRobinPolicy"><code class="xref py py-class docutils literal"><span class="pre">RoundRobinPolicy</span></code></a> which evenly
distributes queries across all nodes in the cluster,
regardless of what datacenter the nodes may be in, but
only if that node exists in the list of allowed nodes</p>
<p>This policy is addresses the issue described in
<a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-145">https://datastax-oss.atlassian.net/browse/JAVA-145</a>
Where connection errors occur when connection
attempts are made to private IP addresses remotely</p>
<p>The <cite>hosts</cite> parameter should be a sequence of hosts to permit
connections to.</p>
</dd></dl>

<dl class="class">
<dt id="cassandra.policies.TokenAwarePolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">TokenAwarePolicy</code><span class="sig-paren">(</span><em>child_policy</em>, <em>shuffle_replicas=False</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#TokenAwarePolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.TokenAwarePolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#cassandra.policies.LoadBalancingPolicy" title="cassandra.policies.LoadBalancingPolicy"><code class="xref py py-class docutils literal"><span class="pre">LoadBalancingPolicy</span></code></a> wrapper that adds token awareness to
a child policy.</p>
<p>This alters the child policy’s behavior so that it first attempts to
send queries to <a class="reference internal" href="#cassandra.policies.HostDistance.LOCAL" title="cassandra.policies.HostDistance.LOCAL"><code class="xref py py-attr docutils literal"><span class="pre">LOCAL</span></code></a> replicas (as determined
by the child policy) based on the <a class="reference internal" href="query.html#cassandra.query.Statement" title="cassandra.query.Statement"><code class="xref py py-class docutils literal"><span class="pre">Statement</span></code></a>’s
<a class="reference internal" href="query.html#cassandra.query.Statement.routing_key" title="cassandra.query.Statement.routing_key"><code class="xref py py-attr docutils literal"><span class="pre">routing_key</span></code></a>. If <a class="reference internal" href="#cassandra.policies.TokenAwarePolicy.shuffle_replicas" title="cassandra.policies.TokenAwarePolicy.shuffle_replicas"><code class="xref py py-attr docutils literal"><span class="pre">shuffle_replicas</span></code></a> is
truthy, these replicas will be yielded in a random order. Once those
hosts are exhausted, the remaining hosts in the child policy’s query
plan will be used in the order provided by the child policy.</p>
<p>If no <a class="reference internal" href="query.html#cassandra.query.Statement.routing_key" title="cassandra.query.Statement.routing_key"><code class="xref py py-attr docutils literal"><span class="pre">routing_key</span></code></a> is set on the query, the child
policy’s query plan will be used as is.</p>
<dl class="attribute">
<dt id="cassandra.policies.TokenAwarePolicy.shuffle_replicas">
<code class="descname">shuffle_replicas</code><em class="property"> = False</em><a class="headerlink" href="#cassandra.policies.TokenAwarePolicy.shuffle_replicas" title="Permalink to this definition">¶</a></dt>
<dd><p>Yield local replicas in a random order.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cassandra.policies.HostFilterPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">HostFilterPolicy</code><span class="sig-paren">(</span><em>child_policy</em>, <em>predicate</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#HostFilterPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.HostFilterPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#cassandra.policies.LoadBalancingPolicy" title="cassandra.policies.LoadBalancingPolicy"><code class="xref py py-class docutils literal"><span class="pre">LoadBalancingPolicy</span></code></a> subclass configured with a child policy,
and a single-argument predicate. This policy defers to the child policy for
hosts where <code class="docutils literal"><span class="pre">predicate(host)</span></code> is truthy. Hosts for which
<code class="docutils literal"><span class="pre">predicate(host)</span></code> is falsey will be considered <a class="reference internal" href="#cassandra.policies.HostDistance.IGNORED" title="cassandra.policies.HostDistance.IGNORED"><code class="xref py py-attr docutils literal"><span class="pre">IGNORED</span></code></a>, and will
not be used in a query plan.</p>
<p>This can be used in the cases where you need a whitelist or blacklist
policy, e.g. to prepare for decommissioning nodes or for testing:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">address_is_ignored</span><span class="p">(</span><span class="n">host</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">host</span><span class="o">.</span><span class="n">address</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ignored_address0</span><span class="p">,</span> <span class="n">ignored_address1</span><span class="p">]</span>

<span class="n">blacklist_filter_policy</span> <span class="o">=</span> <span class="n">HostFilterPolicy</span><span class="p">(</span>
    <span class="n">child_policy</span><span class="o">=</span><span class="n">RoundRobinPolicy</span><span class="p">(),</span>
    <span class="n">predicate</span><span class="o">=</span><span class="n">address_is_ignored</span>
<span class="p">)</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span>
    <span class="n">primary_host</span><span class="p">,</span>
    <span class="n">load_balancing_policy</span><span class="o">=</span><span class="n">blacklist_filter_policy</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>See the note in the <a class="reference internal" href="#cassandra.policies.HostFilterPolicy.make_query_plan" title="cassandra.policies.HostFilterPolicy.make_query_plan"><code class="xref py py-meth docutils literal"><span class="pre">make_query_plan()</span></code></a> documentation for a caveat on
how wrapping ordering polices (e.g. <a class="reference internal" href="#cassandra.policies.RoundRobinPolicy" title="cassandra.policies.RoundRobinPolicy"><code class="xref py py-class docutils literal"><span class="pre">RoundRobinPolicy</span></code></a>) may break
desirable properties of the wrapped policy.</p>
<p>Please note that whitelist and blacklist policies are not recommended for
general, day-to-day use. You probably want something like
<a class="reference internal" href="#cassandra.policies.DCAwareRoundRobinPolicy" title="cassandra.policies.DCAwareRoundRobinPolicy"><code class="xref py py-class docutils literal"><span class="pre">DCAwareRoundRobinPolicy</span></code></a>, which prefers a local DC but has
fallbacks, over a brute-force method like whitelisting or blacklisting.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>child_policy</strong> – an instantiated <a class="reference internal" href="#cassandra.policies.LoadBalancingPolicy" title="cassandra.policies.LoadBalancingPolicy"><code class="xref py py-class docutils literal"><span class="pre">LoadBalancingPolicy</span></code></a>
that this one will defer to.</li>
<li><strong>predicate</strong> – a one-parameter function that takes a <a class="reference internal" href="pool.html#cassandra.pool.Host" title="cassandra.pool.Host"><code class="xref py py-class docutils literal"><span class="pre">Host</span></code></a>.
If it returns a falsey value, the <a class="reference internal" href="pool.html#cassandra.pool.Host" title="cassandra.pool.Host"><code class="xref py py-class docutils literal"><span class="pre">Host</span></code></a> will
be <a class="reference internal" href="#cassandra.policies.HostDistance.IGNORED" title="cassandra.policies.HostDistance.IGNORED"><code class="xref py py-attr docutils literal"><span class="pre">IGNORED</span></code></a> and not returned in query plans.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="cassandra.policies.HostFilterPolicy.predicate">
<code class="descname">predicate</code><span class="sig-paren">(</span><em>host</em><span class="sig-paren">)</span><a class="headerlink" href="#cassandra.policies.HostFilterPolicy.predicate" title="Permalink to this definition">¶</a></dt>
<dd><p>A predicate, set on object initialization, that takes a <a class="reference internal" href="pool.html#cassandra.pool.Host" title="cassandra.pool.Host"><code class="xref py py-class docutils literal"><span class="pre">Host</span></code></a>
and returns a value. If the value is falsy, the <a class="reference internal" href="pool.html#cassandra.pool.Host" title="cassandra.pool.Host"><code class="xref py py-class docutils literal"><span class="pre">Host</span></code></a> is
<a class="reference internal" href="#cassandra.policies.HostDistance.IGNORED" title="cassandra.policies.HostDistance.IGNORED"><code class="xref py py-class docutils literal"><span class="pre">IGNORED</span></code></a>. If the value is truthy,
<a class="reference internal" href="#cassandra.policies.HostFilterPolicy" title="cassandra.policies.HostFilterPolicy"><code class="xref py py-class docutils literal"><span class="pre">HostFilterPolicy</span></code></a> defers to the child policy to determine the
host’s distance.</p>
<p>This is a read-only value set in <code class="docutils literal"><span class="pre">__init__</span></code>, implemented as a
<code class="docutils literal"><span class="pre">property</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="cassandra.policies.HostFilterPolicy.distance">
<code class="descname">distance</code><span class="sig-paren">(</span><em>host</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#HostFilterPolicy.distance"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.HostFilterPolicy.distance" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if <code class="docutils literal"><span class="pre">predicate(host)</span></code>, then returns
<a class="reference internal" href="#cassandra.policies.HostDistance.IGNORED" title="cassandra.policies.HostDistance.IGNORED"><code class="xref py py-attr docutils literal"><span class="pre">IGNORED</span></code></a> if falsey, and defers to the child policy
otherwise.</p>
</dd></dl>

<dl class="method">
<dt id="cassandra.policies.HostFilterPolicy.make_query_plan">
<code class="descname">make_query_plan</code><span class="sig-paren">(</span><em>working_keyspace=None</em>, <em>query=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#HostFilterPolicy.make_query_plan"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.HostFilterPolicy.make_query_plan" title="Permalink to this definition">¶</a></dt>
<dd><p>Defers to the child policy’s
<a class="reference internal" href="#cassandra.policies.LoadBalancingPolicy.make_query_plan" title="cassandra.policies.LoadBalancingPolicy.make_query_plan"><code class="xref py py-meth docutils literal"><span class="pre">LoadBalancingPolicy.make_query_plan()</span></code></a> and filters the results.</p>
<p>Note that this filtering may break desirable properties of the wrapped
policy in some cases. For instance, imagine if you configure this
policy to filter out <code class="docutils literal"><span class="pre">host2</span></code>, and to wrap a round-robin policy that
rotates through three hosts in the order <code class="docutils literal"><span class="pre">host1,</span> <span class="pre">host2,</span> <span class="pre">host3</span></code>,
<code class="docutils literal"><span class="pre">host2,</span> <span class="pre">host3,</span> <span class="pre">host1</span></code>, <code class="docutils literal"><span class="pre">host3,</span> <span class="pre">host1,</span> <span class="pre">host2</span></code>, repeating. This
policy will yield <code class="docutils literal"><span class="pre">host1,</span> <span class="pre">host3</span></code>, <code class="docutils literal"><span class="pre">host3,</span> <span class="pre">host1</span></code>, <code class="docutils literal"><span class="pre">host3,</span> <span class="pre">host1</span></code>,
disproportionately favoring <code class="docutils literal"><span class="pre">host3</span></code>.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="translating-server-node-addresses">
<h2>Translating Server Node Addresses<a class="headerlink" href="#translating-server-node-addresses" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cassandra.policies.AddressTranslator">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">AddressTranslator</code><a class="reference internal" href="../../_modules/cassandra/policies.html#AddressTranslator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.AddressTranslator" title="Permalink to this definition">¶</a></dt>
<dd><p>Interface for translating cluster-defined endpoints.</p>
<p>The driver discovers nodes using server metadata and topology change events. Normally,
the endpoint defined by the server is the right way to connect to a node. In some environments,
these addresses may not be reachable, or not preferred (public vs. private IPs in cloud environments,
suboptimal routing, etc). This interface allows for translating from server defined endpoints to
preferred addresses for driver connections.</p>
<p><em>Note:</em> <code class="xref py py-attr docutils literal"><span class="pre">contact_points</span></code> provided while creating the <a class="reference internal" href="cluster.html#cassandra.cluster.Cluster" title="cassandra.cluster.Cluster"><code class="xref py py-class docutils literal"><span class="pre">Cluster</span></code></a> instance are not
translated using this mechanism – only addresses received from Cassandra nodes are.</p>
<dl class="method">
<dt id="cassandra.policies.AddressTranslator.translate">
<code class="descname">translate</code><span class="sig-paren">(</span><em>addr</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#AddressTranslator.translate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.AddressTranslator.translate" title="Permalink to this definition">¶</a></dt>
<dd><p>Accepts the node ip address, and returns a translated address to be used connecting to this node.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cassandra.policies.IdentityTranslator">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">IdentityTranslator</code><a class="reference internal" href="../../_modules/cassandra/policies.html#IdentityTranslator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.IdentityTranslator" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the endpoint with no translation</p>
</dd></dl>

<dl class="class">
<dt id="cassandra.policies.EC2MultiRegionTranslator">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">EC2MultiRegionTranslator</code><a class="reference internal" href="../../_modules/cassandra/policies.html#EC2MultiRegionTranslator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.EC2MultiRegionTranslator" title="Permalink to this definition">¶</a></dt>
<dd><p>Resolves private ips of the hosts in the same datacenter as the client, and public ips of hosts in other datacenters.</p>
<dl class="method">
<dt id="cassandra.policies.EC2MultiRegionTranslator.translate">
<code class="descname">translate</code><span class="sig-paren">(</span><em>addr</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#EC2MultiRegionTranslator.translate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.EC2MultiRegionTranslator.translate" title="Permalink to this definition">¶</a></dt>
<dd><p>Reverse DNS the public broadcast_address, then lookup that hostname to get the AWS-resolved IP, which
will point to the private IP address within the same datacenter.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="marking-hosts-up-or-down">
<h2>Marking Hosts Up or Down<a class="headerlink" href="#marking-hosts-up-or-down" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cassandra.policies.ConvictionPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">ConvictionPolicy</code><span class="sig-paren">(</span><em>host</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#ConvictionPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.ConvictionPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>A policy which decides when hosts should be considered down
based on the types of failures and the number of failures.</p>
<p>If custom behavior is needed, this class may be subclassed.</p>
<p><cite>host</cite> is an instance of <a class="reference internal" href="pool.html#cassandra.pool.Host" title="cassandra.pool.Host"><code class="xref py py-class docutils literal"><span class="pre">Host</span></code></a>.</p>
<dl class="method">
<dt id="cassandra.policies.ConvictionPolicy.add_failure">
<code class="descname">add_failure</code><span class="sig-paren">(</span><em>connection_exc</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#ConvictionPolicy.add_failure"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.ConvictionPolicy.add_failure" title="Permalink to this definition">¶</a></dt>
<dd><p>Implementations should return <code class="xref py py-const docutils literal"><span class="pre">True</span></code> if the host should be
convicted, <code class="xref py py-const docutils literal"><span class="pre">False</span></code> otherwise.</p>
</dd></dl>

<dl class="method">
<dt id="cassandra.policies.ConvictionPolicy.reset">
<code class="descname">reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#ConvictionPolicy.reset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.ConvictionPolicy.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Implementations should clear out any convictions or state regarding
the host.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cassandra.policies.SimpleConvictionPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">SimpleConvictionPolicy</code><span class="sig-paren">(</span><em>host</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#SimpleConvictionPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.SimpleConvictionPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>The default implementation of <a class="reference internal" href="#cassandra.policies.ConvictionPolicy" title="cassandra.policies.ConvictionPolicy"><code class="xref py py-class docutils literal"><span class="pre">ConvictionPolicy</span></code></a>,
which simply marks a host as down after the first failure
of any kind.</p>
<p><cite>host</cite> is an instance of <a class="reference internal" href="pool.html#cassandra.pool.Host" title="cassandra.pool.Host"><code class="xref py py-class docutils literal"><span class="pre">Host</span></code></a>.</p>
</dd></dl>

</div>
<div class="section" id="reconnecting-to-dead-hosts">
<h2>Reconnecting to Dead Hosts<a class="headerlink" href="#reconnecting-to-dead-hosts" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cassandra.policies.ReconnectionPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">ReconnectionPolicy</code><a class="reference internal" href="../../_modules/cassandra/policies.html#ReconnectionPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.ReconnectionPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>This class and its subclasses govern how frequently an attempt is made
to reconnect to nodes that are marked as dead.</p>
<p>If custom behavior is needed, this class may be subclassed.</p>
<dl class="method">
<dt id="cassandra.policies.ReconnectionPolicy.new_schedule">
<code class="descname">new_schedule</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#ReconnectionPolicy.new_schedule"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.ReconnectionPolicy.new_schedule" title="Permalink to this definition">¶</a></dt>
<dd><p>This should return a finite or infinite iterable of delays (each as a
floating point number of seconds) inbetween each failed reconnection
attempt.  Note that if the iterable is finite, reconnection attempts
will cease once the iterable is exhausted.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cassandra.policies.ConstantReconnectionPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">ConstantReconnectionPolicy</code><span class="sig-paren">(</span><em>delay</em>, <em>max_attempts=64</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#ConstantReconnectionPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.ConstantReconnectionPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#cassandra.policies.ReconnectionPolicy" title="cassandra.policies.ReconnectionPolicy"><code class="xref py py-class docutils literal"><span class="pre">ReconnectionPolicy</span></code></a> subclass which sleeps for a fixed delay
inbetween each reconnection attempt.</p>
<p><cite>delay</cite> should be a floating point number of seconds to wait inbetween
each attempt.</p>
<p><cite>max_attempts</cite> should be a total number of attempts to be made before
giving up, or <code class="xref py py-const docutils literal"><span class="pre">None</span></code> to continue reconnection attempts forever.
The default is 64.</p>
</dd></dl>

<dl class="class">
<dt id="cassandra.policies.ExponentialReconnectionPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">ExponentialReconnectionPolicy</code><span class="sig-paren">(</span><em>base_delay</em>, <em>max_delay</em>, <em>max_attempts=64</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#ExponentialReconnectionPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.ExponentialReconnectionPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#cassandra.policies.ReconnectionPolicy" title="cassandra.policies.ReconnectionPolicy"><code class="xref py py-class docutils literal"><span class="pre">ReconnectionPolicy</span></code></a> subclass which exponentially increases
the length of the delay inbetween each reconnection attempt up to
a set maximum delay.</p>
<p><cite>base_delay</cite> and <cite>max_delay</cite> should be in floating point units of
seconds.</p>
<p><cite>max_attempts</cite> should be a total number of attempts to be made before
giving up, or <code class="xref py py-const docutils literal"><span class="pre">None</span></code> to continue reconnection attempts forever.
The default is 64.</p>
</dd></dl>

</div>
<div class="section" id="retrying-failed-operations">
<h2>Retrying Failed Operations<a class="headerlink" href="#retrying-failed-operations" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cassandra.policies.WriteType">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">WriteType</code><a class="reference internal" href="../../_modules/cassandra/policies.html#WriteType"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.WriteType" title="Permalink to this definition">¶</a></dt>
<dd><p>For usage with <a class="reference internal" href="#cassandra.policies.RetryPolicy" title="cassandra.policies.RetryPolicy"><code class="xref py py-class docutils literal"><span class="pre">RetryPolicy</span></code></a>, this describe a type
of write operation.</p>
<dl class="attribute">
<dt id="cassandra.policies.WriteType.SIMPLE">
<code class="descname">SIMPLE</code><em class="property"> = 0</em><a class="headerlink" href="#cassandra.policies.WriteType.SIMPLE" title="Permalink to this definition">¶</a></dt>
<dd><p>A write to a single partition key. Such writes are guaranteed to be atomic
and isolated.</p>
</dd></dl>

<dl class="attribute">
<dt id="cassandra.policies.WriteType.BATCH">
<code class="descname">BATCH</code><em class="property"> = 1</em><a class="headerlink" href="#cassandra.policies.WriteType.BATCH" title="Permalink to this definition">¶</a></dt>
<dd><p>A write to multiple partition keys that used the distributed batch log to
ensure atomicity.</p>
</dd></dl>

<dl class="attribute">
<dt id="cassandra.policies.WriteType.UNLOGGED_BATCH">
<code class="descname">UNLOGGED_BATCH</code><em class="property"> = 2</em><a class="headerlink" href="#cassandra.policies.WriteType.UNLOGGED_BATCH" title="Permalink to this definition">¶</a></dt>
<dd><p>A write to multiple partition keys that did not use the distributed batch
log. Atomicity for such writes is not guaranteed.</p>
</dd></dl>

<dl class="attribute">
<dt id="cassandra.policies.WriteType.COUNTER">
<code class="descname">COUNTER</code><em class="property"> = 3</em><a class="headerlink" href="#cassandra.policies.WriteType.COUNTER" title="Permalink to this definition">¶</a></dt>
<dd><p>A counter write (for one or multiple partition keys). Such writes should
not be replayed in order to avoid overcount.</p>
</dd></dl>

<dl class="attribute">
<dt id="cassandra.policies.WriteType.BATCH_LOG">
<code class="descname">BATCH_LOG</code><em class="property"> = 4</em><a class="headerlink" href="#cassandra.policies.WriteType.BATCH_LOG" title="Permalink to this definition">¶</a></dt>
<dd><p>The initial write to the distributed batch log that Cassandra performs
internally before a BATCH write.</p>
</dd></dl>

<dl class="attribute">
<dt id="cassandra.policies.WriteType.CAS">
<code class="descname">CAS</code><em class="property"> = 5</em><a class="headerlink" href="#cassandra.policies.WriteType.CAS" title="Permalink to this definition">¶</a></dt>
<dd><p>A lighweight-transaction write, such as “DELETE … IF EXISTS”.</p>
</dd></dl>

<dl class="attribute">
<dt id="cassandra.policies.WriteType.VIEW">
<code class="descname">VIEW</code><em class="property"> = 6</em><a class="headerlink" href="#cassandra.policies.WriteType.VIEW" title="Permalink to this definition">¶</a></dt>
<dd><p>This WriteType is only seen in results for requests that were unable to
complete MV operations.</p>
</dd></dl>

<dl class="attribute">
<dt id="cassandra.policies.WriteType.CDC">
<code class="descname">CDC</code><em class="property"> = 7</em><a class="headerlink" href="#cassandra.policies.WriteType.CDC" title="Permalink to this definition">¶</a></dt>
<dd><p>This WriteType is only seen in results for requests that were unable to
complete CDC operations.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cassandra.policies.RetryPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">RetryPolicy</code><a class="reference internal" href="../../_modules/cassandra/policies.html#RetryPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.RetryPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>A policy that describes whether to retry, rethrow, or ignore coordinator
timeout and unavailable failures. These are failures reported from the
server side. Timeouts are configured by
<a class="reference external" href="https://github.com/apache/cassandra/blob/cassandra-2.1.4/conf/cassandra.yaml#L568-L584">settings in cassandra.yaml</a>.
Unavailable failures occur when the coordinator cannot acheive the consistency
level for a request. For further information see the method descriptions
below.</p>
<p>To specify a default retry policy, set the
<a class="reference internal" href="cluster.html#cassandra.cluster.Cluster.default_retry_policy" title="cassandra.cluster.Cluster.default_retry_policy"><code class="xref py py-attr docutils literal"><span class="pre">Cluster.default_retry_policy</span></code></a> attribute to an instance of this
class or one of its subclasses.</p>
<p>To specify a retry policy per query, set the <a class="reference internal" href="query.html#cassandra.query.Statement.retry_policy" title="cassandra.query.Statement.retry_policy"><code class="xref py py-attr docutils literal"><span class="pre">Statement.retry_policy</span></code></a>
attribute to an instance of this class or one of its subclasses.</p>
<p>If custom behavior is needed for retrying certain operations,
this class may be subclassed.</p>
<dl class="attribute">
<dt id="cassandra.policies.RetryPolicy.RETRY">
<code class="descname">RETRY</code><em class="property"> = 0</em><a class="headerlink" href="#cassandra.policies.RetryPolicy.RETRY" title="Permalink to this definition">¶</a></dt>
<dd><p>This should be returned from the below methods if the operation
should be retried on the same connection.</p>
</dd></dl>

<dl class="attribute">
<dt id="cassandra.policies.RetryPolicy.RETHROW">
<code class="descname">RETHROW</code><em class="property"> = 1</em><a class="headerlink" href="#cassandra.policies.RetryPolicy.RETHROW" title="Permalink to this definition">¶</a></dt>
<dd><p>This should be returned from the below methods if the failure
should be propagated and no more retries attempted.</p>
</dd></dl>

<dl class="attribute">
<dt id="cassandra.policies.RetryPolicy.IGNORE">
<code class="descname">IGNORE</code><em class="property"> = 2</em><a class="headerlink" href="#cassandra.policies.RetryPolicy.IGNORE" title="Permalink to this definition">¶</a></dt>
<dd><p>This should be returned from the below methods if the failure
should be ignored but no more retries should be attempted.</p>
</dd></dl>

<dl class="attribute">
<dt id="cassandra.policies.RetryPolicy.RETRY_NEXT_HOST">
<code class="descname">RETRY_NEXT_HOST</code><em class="property"> = 3</em><a class="headerlink" href="#cassandra.policies.RetryPolicy.RETRY_NEXT_HOST" title="Permalink to this definition">¶</a></dt>
<dd><p>This should be returned from the below methods if the operation
should be retried on another connection.</p>
</dd></dl>

<dl class="method">
<dt id="cassandra.policies.RetryPolicy.on_read_timeout">
<code class="descname">on_read_timeout</code><span class="sig-paren">(</span><em>query</em>, <em>consistency</em>, <em>required_responses</em>, <em>received_responses</em>, <em>data_retrieved</em>, <em>retry_num</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#RetryPolicy.on_read_timeout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.RetryPolicy.on_read_timeout" title="Permalink to this definition">¶</a></dt>
<dd><p>This is called when a read operation times out from the coordinator’s
perspective (i.e. a replica did not respond to the coordinator in time).
It should return a tuple with two items: one of the class enums (such
as <a class="reference internal" href="#cassandra.policies.RetryPolicy.RETRY" title="cassandra.policies.RetryPolicy.RETRY"><code class="xref py py-attr docutils literal"><span class="pre">RETRY</span></code></a>) and a <a class="reference internal" href="../cassandra.html#cassandra.ConsistencyLevel" title="cassandra.ConsistencyLevel"><code class="xref py py-class docutils literal"><span class="pre">ConsistencyLevel</span></code></a> to retry the
operation at or <code class="xref py py-const docutils literal"><span class="pre">None</span></code> to keep the same consistency level.</p>
<p><cite>query</cite> is the <a class="reference internal" href="query.html#cassandra.query.Statement" title="cassandra.query.Statement"><code class="xref py py-class docutils literal"><span class="pre">Statement</span></code></a> that timed out.</p>
<p><cite>consistency</cite> is the <a class="reference internal" href="../cassandra.html#cassandra.ConsistencyLevel" title="cassandra.ConsistencyLevel"><code class="xref py py-class docutils literal"><span class="pre">ConsistencyLevel</span></code></a> that the operation was
attempted at.</p>
<p>The <cite>required_responses</cite> and <cite>received_responses</cite> parameters describe
how many replicas needed to respond to meet the requested consistency
level and how many actually did respond before the coordinator timed
out the request. <cite>data_retrieved</cite> is a boolean indicating whether
any of those responses contained data (as opposed to just a digest).</p>
<p><cite>retry_num</cite> counts how many times the operation has been retried, so
the first time this method is called, <cite>retry_num</cite> will be 0.</p>
<p>By default, operations will be retried at most once, and only if
a sufficient number of replicas responded (with data digests).</p>
</dd></dl>

<dl class="method">
<dt id="cassandra.policies.RetryPolicy.on_write_timeout">
<code class="descname">on_write_timeout</code><span class="sig-paren">(</span><em>query</em>, <em>consistency</em>, <em>write_type</em>, <em>required_responses</em>, <em>received_responses</em>, <em>retry_num</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#RetryPolicy.on_write_timeout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.RetryPolicy.on_write_timeout" title="Permalink to this definition">¶</a></dt>
<dd><p>This is called when a write operation times out from the coordinator’s
perspective (i.e. a replica did not respond to the coordinator in time).</p>
<p><cite>query</cite> is the <a class="reference internal" href="query.html#cassandra.query.Statement" title="cassandra.query.Statement"><code class="xref py py-class docutils literal"><span class="pre">Statement</span></code></a> that timed out.</p>
<p><cite>consistency</cite> is the <a class="reference internal" href="../cassandra.html#cassandra.ConsistencyLevel" title="cassandra.ConsistencyLevel"><code class="xref py py-class docutils literal"><span class="pre">ConsistencyLevel</span></code></a> that the operation was
attempted at.</p>
<p><cite>write_type</cite> is one of the <a class="reference internal" href="#cassandra.policies.WriteType" title="cassandra.policies.WriteType"><code class="xref py py-class docutils literal"><span class="pre">WriteType</span></code></a> enums describing the
type of write operation.</p>
<p>The <cite>required_responses</cite> and <cite>received_responses</cite> parameters describe
how many replicas needed to acknowledge the write to meet the requested
consistency level and how many replicas actually did acknowledge the
write before the coordinator timed out the request.</p>
<p><cite>retry_num</cite> counts how many times the operation has been retried, so
the first time this method is called, <cite>retry_num</cite> will be 0.</p>
<p>By default, failed write operations will retried at most once, and
they will only be retried if the <cite>write_type</cite> was
<a class="reference internal" href="#cassandra.policies.WriteType.BATCH_LOG" title="cassandra.policies.WriteType.BATCH_LOG"><code class="xref py py-attr docutils literal"><span class="pre">BATCH_LOG</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="cassandra.policies.RetryPolicy.on_unavailable">
<code class="descname">on_unavailable</code><span class="sig-paren">(</span><em>query</em>, <em>consistency</em>, <em>required_replicas</em>, <em>alive_replicas</em>, <em>retry_num</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#RetryPolicy.on_unavailable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.RetryPolicy.on_unavailable" title="Permalink to this definition">¶</a></dt>
<dd><p>This is called when the coordinator node determines that a read or
write operation cannot be successful because the number of live
replicas are too low to meet the requested <a class="reference internal" href="../cassandra.html#cassandra.ConsistencyLevel" title="cassandra.ConsistencyLevel"><code class="xref py py-class docutils literal"><span class="pre">ConsistencyLevel</span></code></a>.
This means that the read or write operation was never forwared to
any replicas.</p>
<p><cite>query</cite> is the <a class="reference internal" href="query.html#cassandra.query.Statement" title="cassandra.query.Statement"><code class="xref py py-class docutils literal"><span class="pre">Statement</span></code></a> that failed.</p>
<p><cite>consistency</cite> is the <a class="reference internal" href="../cassandra.html#cassandra.ConsistencyLevel" title="cassandra.ConsistencyLevel"><code class="xref py py-class docutils literal"><span class="pre">ConsistencyLevel</span></code></a> that the operation was
attempted at.</p>
<p><cite>required_replicas</cite> is the number of replicas that would have needed to
acknowledge the operation to meet the requested consistency level.
<cite>alive_replicas</cite> is the number of replicas that the coordinator
considered alive at the time of the request.</p>
<p><cite>retry_num</cite> counts how many times the operation has been retried, so
the first time this method is called, <cite>retry_num</cite> will be 0.</p>
<p>By default, no retries will be attempted and the error will be re-raised.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cassandra.policies.FallthroughRetryPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">FallthroughRetryPolicy</code><a class="reference internal" href="../../_modules/cassandra/policies.html#FallthroughRetryPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.FallthroughRetryPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>A retry policy that never retries and always propagates failures to
the application.</p>
</dd></dl>

<dl class="class">
<dt id="cassandra.policies.DowngradingConsistencyRetryPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">DowngradingConsistencyRetryPolicy</code><a class="reference internal" href="../../_modules/cassandra/policies.html#DowngradingConsistencyRetryPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.DowngradingConsistencyRetryPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>A retry policy that sometimes retries with a lower consistency level than
the one initially requested.</p>
<p><strong>BEWARE</strong>: This policy may retry queries using a lower consistency
level than the one initially requested. By doing so, it may break
consistency guarantees. In other words, if you use this retry policy,
there are cases (documented below) where a read at <a class="reference internal" href="../cassandra.html#cassandra.ConsistencyLevel.QUORUM" title="cassandra.ConsistencyLevel.QUORUM"><code class="xref py py-attr docutils literal"><span class="pre">QUORUM</span></code></a>
<em>may not</em> see a preceding write at <a class="reference internal" href="../cassandra.html#cassandra.ConsistencyLevel.QUORUM" title="cassandra.ConsistencyLevel.QUORUM"><code class="xref py py-attr docutils literal"><span class="pre">QUORUM</span></code></a>. Do not use this
policy unless you have understood the cases where this can happen and
are ok with that. It is also recommended to subclass this class so
that queries that required a consistency level downgrade can be
recorded (so that repairs can be made later, etc).</p>
<p>This policy implements the same retries as <a class="reference internal" href="#cassandra.policies.RetryPolicy" title="cassandra.policies.RetryPolicy"><code class="xref py py-class docutils literal"><span class="pre">RetryPolicy</span></code></a>,
but on top of that, it also retries in the following cases:</p>
<ul class="simple">
<li>On a read timeout: if the number of replicas that responded is
greater than one but lower than is required by the requested
consistency level, the operation is retried at a lower consistency
level.</li>
<li>On a write timeout: if the operation is an <a class="reference internal" href="#cassandra.policies.WriteType.UNLOGGED_BATCH" title="cassandra.policies.WriteType.UNLOGGED_BATCH"><code class="xref py py-attr docutils literal"><span class="pre">UNLOGGED_BATCH</span></code></a>
and at least one replica acknowledged the write, the operation is
retried at a lower consistency level.  Furthermore, for other
write types, if at least one replica acknowledged the write, the
timeout is ignored.</li>
<li>On an unavailable exception: if at least one replica is alive, the
operation is retried at a lower consistency level.</li>
</ul>
<p>The reasoning behind this retry policy is as follows: if, based
on the information the Cassandra coordinator node returns, retrying the
operation with the initially requested consistency has a chance to
succeed, do it. Otherwise, if based on that information we know the
initially requested consistency level cannot be achieved currently, then:</p>
<ul class="simple">
<li>For writes, ignore the exception (thus silently failing the
consistency requirement) if we know the write has been persisted on at
least one replica.</li>
<li>For reads, try reading at a lower consistency level (thus silently
failing the consistency requirement).</li>
</ul>
<p>In other words, this policy implements the idea that if the requested
consistency level cannot be achieved, the next best thing for writes is
to make sure the data is persisted, and that reading something is better
than reading nothing, even if there is a risk of reading stale data.</p>
</dd></dl>

</div>
<div class="section" id="retrying-idempotent-operations">
<h2>Retrying Idempotent Operations<a class="headerlink" href="#retrying-idempotent-operations" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cassandra.policies.SpeculativeExecutionPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">SpeculativeExecutionPolicy</code><a class="reference internal" href="../../_modules/cassandra/policies.html#SpeculativeExecutionPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.SpeculativeExecutionPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>Interface for specifying speculative execution plans</p>
<dl class="method">
<dt id="cassandra.policies.SpeculativeExecutionPolicy.new_plan">
<code class="descname">new_plan</code><span class="sig-paren">(</span><em>keyspace</em>, <em>statement</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#SpeculativeExecutionPolicy.new_plan"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.SpeculativeExecutionPolicy.new_plan" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>keyspace</strong> – </li>
<li><strong>statement</strong> – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cassandra.policies.ConstantSpeculativeExecutionPolicy">
<em class="property">class </em><code class="descclassname">cassandra.policies.</code><code class="descname">ConstantSpeculativeExecutionPolicy</code><span class="sig-paren">(</span><em>delay</em>, <em>max_attempts</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/cassandra/policies.html#ConstantSpeculativeExecutionPolicy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cassandra.policies.ConstantSpeculativeExecutionPolicy" title="Permalink to this definition">¶</a></dt>
<dd><p>A speculative execution policy that sends a new query every X seconds (<strong>delay</strong>) for a maximum of Y attempts (<strong>max_attempts</strong>).</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Cassandra Driver</a></h1>



<p class="blurb">Python driver for Cassandra</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=datastax&repo=python-driver&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#core-driver">Core Driver</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../cassandra.html"><code class="docutils literal"><span class="pre">cassandra</span></code> - Exceptions and Enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="cluster.html"><code class="docutils literal"><span class="pre">cassandra.cluster</span></code> - Clusters and Sessions</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#"><code class="docutils literal"><span class="pre">cassandra.policies</span></code> - Load balancing and Failure Handling Policies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#load-balancing">Load Balancing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#translating-server-node-addresses">Translating Server Node Addresses</a></li>
<li class="toctree-l4"><a class="reference internal" href="#marking-hosts-up-or-down">Marking Hosts Up or Down</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reconnecting-to-dead-hosts">Reconnecting to Dead Hosts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#retrying-failed-operations">Retrying Failed Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#retrying-idempotent-operations">Retrying Idempotent Operations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="auth.html"><code class="docutils literal"><span class="pre">cassandra.auth</span></code> - Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="metadata.html"><code class="docutils literal"><span class="pre">cassandra.metadata</span></code> - Schema and Ring Topology</a></li>
<li class="toctree-l3"><a class="reference internal" href="metrics.html"><code class="docutils literal"><span class="pre">cassandra.metrics</span></code> - Performance Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="query.html"><code class="docutils literal"><span class="pre">cassandra.query</span></code> - Prepared Statements, Batch Statements, Tracing, and Row Factories</a></li>
<li class="toctree-l3"><a class="reference internal" href="pool.html"><code class="docutils literal"><span class="pre">cassandra.pool</span></code> - Hosts and Connection Pools</a></li>
<li class="toctree-l3"><a class="reference internal" href="protocol.html"><code class="docutils literal"><span class="pre">cassandra.protocol</span></code> - Protocol Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="encoder.html"><code class="docutils literal"><span class="pre">cassandra.encoder</span></code> - Encoders for non-prepared Statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="decoder.html"><code class="docutils literal"><span class="pre">cassandra.decoder</span></code> - Data Return Formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="concurrent.html"><code class="docutils literal"><span class="pre">cassandra.concurrent</span></code> - Utilities for Concurrent Statement Execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="connection.html"><code class="docutils literal"><span class="pre">cassandra.connection</span></code> - Low Level Connection Info</a></li>
<li class="toctree-l3"><a class="reference internal" href="util.html"><code class="docutils literal"><span class="pre">cassandra.util</span></code> - Utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="io/asyncioreactor.html"><code class="docutils literal"><span class="pre">cassandra.io.asyncioreactor</span></code> - <code class="docutils literal"><span class="pre">asyncio</span></code> Event Loop</a></li>
<li class="toctree-l3"><a class="reference internal" href="io/asyncorereactor.html"><code class="docutils literal"><span class="pre">cassandra.io.asyncorereactor</span></code> - <code class="docutils literal"><span class="pre">asyncore</span></code> Event Loop</a></li>
<li class="toctree-l3"><a class="reference internal" href="io/eventletreactor.html"><code class="docutils literal"><span class="pre">cassandra.io.eventletreactor</span></code> - <code class="docutils literal"><span class="pre">eventlet</span></code>-compatible Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="io/libevreactor.html"><code class="docutils literal"><span class="pre">cassandra.io.libevreactor</span></code> - <code class="docutils literal"><span class="pre">libev</span></code> Event Loop</a></li>
<li class="toctree-l3"><a class="reference internal" href="io/geventreactor.html"><code class="docutils literal"><span class="pre">cassandra.io.geventreactor</span></code> - <code class="docutils literal"><span class="pre">gevent</span></code>-compatible Event Loop</a></li>
<li class="toctree-l3"><a class="reference internal" href="io/twistedreactor.html"><code class="docutils literal"><span class="pre">cassandra.io.twistedreactor</span></code> - Twisted Event Loop</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#object-mapper">Object Mapper</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrading.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../execution_profiles.html">Execution Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance.html">Performance Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../query_paging.html">Paging Large Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lwt.html">Lightweight Transactions (Compare-and-set)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_defined_types.html">User Defined Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../object_mapper.html">Object Mapper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dates_and_times.html">Working with Dates and Times</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently Asked Questions</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">API Documentation</a><ul>
      <li>Previous: <a href="cluster.html" title="previous chapter"><code class="docutils literal"><span class="pre">cassandra.cluster</span></code> - Clusters and Sessions</a></li>
      <li>Next: <a href="auth.html" title="next chapter"><code class="docutils literal"><span class="pre">cassandra.auth</span></code> - Authentication</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2013-2017 DataStax.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../../_sources/api/cassandra/policies.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>